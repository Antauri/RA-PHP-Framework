
(function($){$.fn.EasyWidgets=function(settings){var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);$(s.selectors.editbox).hide();var widgetMenu='<span class="'+s.selectors.widgetMenu.replace(/\./,'')+'"></span>';$(widgetMenu).appendTo(s.selectors.header);var widgetsIds=new Array();$(s.selectors.widget).each(function(widgetCount){var cookieValue='';var thisWidget=$(this);var thisWidgetId=thisWidget.attr('id');var haveWidgetId=$.trim(thisWidgetId)!='';var thisWidgetMenu=thisWidget.find(s.selectors.widgetMenu);var thisWidgetContent=thisWidget.find(s.selectors.content);if(haveWidgetId){widgetsIds[widgetCount]=thisWidgetId;}if(haveWidgetId&&s.behaviour.useCookies&&GetCookie(s.cookies.closeName)){cookieValue=GetCookie(s.cookies.closeName);if(cookieValue.indexOf(thisWidgetId)!=-1){thisWidget.hide();}}var collapseLink='';if(thisWidget.hasClass(s.options.collapsable)){if(thisWidget.hasClass(s.options.collapse)){collapseLink=MenuLink(s.i18n.extendText,s.i18n.extendTitle,s.selectors.collapseLink);thisWidgetContent.hide();}else{collapseLink=MenuLink(s.i18n.collapseText,s.i18n.collapseTitle,s.selectors.collapseLink);}if(haveWidgetId&&s.behaviour.useCookies&&GetCookie(s.cookies.collapseName)){cookieValue=GetCookie(s.cookies.collapseName);if(cookieValue.indexOf(thisWidgetId)!=-1){collapseLink=MenuLink(s.i18n.extendText,s.i18n.extendTitle,s.selectors.collapseLink);thisWidgetContent.hide();}}$(collapseLink).mousedown(function(e){e.stopPropagation();}).click(function(){var thisLink=$(this);var canExtend=true;var canCollapse=true;var thisWidget=thisLink.parents(s.selectors.widget);var thisWidgetId=thisWidget.attr('id');var haveWidgetId=$.trim(thisWidgetId)!='';var thisWidgetContent=thisWidget.find(s.selectors.content);var contentVisible=thisWidgetContent.css('display')!='none';thisLink.blur();if(contentVisible){if($.isFunction(s.callbacks.onCollapseQuery)){canCollapse=s.callbacks.onCollapseQuery(thisLink,thisWidget);}if(canCollapse){ApplyEffect(thisWidgetContent,s.effects.widgetCollapse,s.effects.effectDuration,false);thisLink.html(s.i18n.extendText);thisLink.attr('title',s.i18n.extendTitle);if(s.behaviour.useCookies&&thisWidgetId){UpdateCookie(thisWidgetId,s.cookies.collapseName,s);}if($.isFunction(s.callbacks.onCollapse)){s.callbacks.onCollapse(thisLink,thisWidget);}}}else{if($.isFunction(s.callbacks.onExtendQuery)){canExtend=s.callbacks.onExtendQuery(thisLink,thisWidget);}if(canExtend){thisLink.html(s.i18n.collapseText);thisLink.attr('title',s.i18n.collapseTitle);ApplyEffect(thisWidgetContent,s.effects.widgetExtend,s.effects.effectDuration,true);if(haveWidgetId&&s.behaviour.useCookies){CleanCookie(thisWidgetId,s.cookies.collapseName,s);}if($.isFunction(s.callbacks.onExtend)){s.callbacks.onExtend(thisLink,thisWidget);}}}return false;}).appendTo(thisWidgetMenu);}var editLink='';if(thisWidget.hasClass(s.options.editable)){editLink=MenuLink(s.i18n.editText,s.i18n.editTitle,s.selectors.editLink);thisWidget.find(s.selectors.closeEdit).click(function(e){var thisLink=$(this);var thisWidget=thisLink.parents(s.selectors.widget);var thisEditLink=thisWidget.find(s.selectors.editLink);var thisEditbox=thisWidget.find(s.selectors.editbox);thisLink.blur();ApplyEffect(thisEditbox,s.effects.widgetCloseEdit,s.effects.effectDuration,false);thisEditLink.html(s.i18n.editText);thisEditLink.attr('title',s.i18n.editTitle);return false;});$(editLink).mousedown(function(e){e.stopPropagation();}).click(function(){var thisLink=$(this);var canShow=canHide=true;var thisWidget=thisLink.parents(s.selectors.widget);var thisEditbox=thisWidget.find(s.selectors.editbox);var thisEditboxVisible=thisEditbox.css('display')!='none';thisLink.blur();if(thisEditboxVisible){if($.isFunction(s.callbacks.onCancelEditQuery)){canHide=s.callbacks.onCancelEditQuery(thisLink,thisWidget);}if(canHide){ApplyEffect(thisEditbox,s.effects.widgetCancelEdit,s.effects.effectDuration,false);thisLink.html(s.i18n.editText);thisLink.attr('title',s.i18n.editTitle);if($.isFunction(s.callbacks.onCancelEdit)){s.callbacks.onCancelEdit(thisLink,thisWidget);}}}else{if($.isFunction(s.callbacks.onEditQuery)){canShow=s.callbacks.onEditQuery(thisLink,thisWidget);}if(canShow){thisLink.html(s.i18n.cancelEditText);thisLink.attr('title',s.i18n.cancelEditTitle);ApplyEffect(thisEditbox,s.effects.widgetOpenEdit,s.effects.effectDuration,true);if($.isFunction(s.callbacks.onEdit)){s.callbacks.onEdit(thisLink,thisWidget);}}}return false;}).appendTo(thisWidgetMenu);}var removeLink='';if(thisWidget.hasClass(s.options.removable)){removeLink=MenuLink(s.i18n.closeText,s.i18n.closeTitle,s.selectors.closeLink);$(removeLink).mousedown(function(e){e.stopPropagation();}).click(function(){var canRemove=true;var thisLink=$(this);var thisWidget=thisLink.parents(s.selectors.widget);var thisWidgetId=thisWidget.attr('id');var haveWidgetId=($.trim(thisWidgetId)!='');thisLink.blur();if($.isFunction(s.callbacks.onCloseQuery)){canRemove=s.callbacks.onCloseQuery(thisLink,thisWidget);}if(canRemove){if(!thisWidget.hasClass(s.options.closeConfirm)||confirm(s.i18n.confirmMsg)){if(haveWidgetId&&s.behaviour.useCookies){UpdateCookie(thisWidgetId,s.cookies.closeName,s);}ApplyEffect(thisWidget,s.effects.widgetClose,s.effects.effectDuration,false);if($.isFunction(s.callbacks.onClose)){s.callbacks.onClose(thisLink,thisWidget);}}}return false;}).appendTo(thisWidgetMenu);}});var i,j=0;var widgetsPositions='';if($.isFunction(s.callbacks.onRefreshPositions)){widgetsPositions=s.callbacks.onRefreshPositions();}else if(s.behaviour.useCookies&&GetCookie(s.cookies.positionName)){widgetsPositions=GetCookie(s.cookies.positionName)}if($.trim(widgetsPositions)!=''){i=j=0;var columns=widgetsPositions.split('|');var totalColumns=columns.length;for(i=0;i<totalColumns;i++){var column=columns[i].split('=');var columnSel='#'+column[0];if($(columnSel)){var widgets=column[1].split(',');var totalWidgets=widgets.length;for(j=0;j<totalWidgets;j++){if($.trim(widgets[j])!=''){var widgetSel='#'+widgets[j];$(widgetSel).appendTo(columnSel);}}}}}var sortableItems=null;sortableItems=(function(){var fixedWidgets='';$(s.selectors.widget).each(function(count){if(!$(this).hasClass(s.options.movable)){if(!this.id){this.id='fixed-widget-id-'+count;}if(fixedWidgets==''){fixedWidgets+='#'+this.id;}else{fixedWidgets+=','+'#'+this.id;}}});var notSelector='';if($.trim(fixedWidgets)==''){notSelector='> '+s.selectors.container;}else{notSelector='> '+s.selectors.container+':not('+fixedWidgets+')';}return $(notSelector,s.selectors.columns);})();sortableItems.find(s.selectors.header).css({cursor:'move'}).mousedown(function(e){var thisHeader=$(this);sortableItems.css({width:''});thisHeader.parent().css({width:thisHeader.parent().width()+'px'});}).mouseup(function(){var thisHeader=$(this);if(!thisHeader.parent().hasClass('dragging')){thisHeader.parent().css({width:''});}else{$(s.selectors.columns).sortable('disable');}});$(s.selectors.columns).sortable({items:sortableItems,containment:'document',forcePlaceholderSize:true,handle:s.selectors.header,delay:s.behaviour.dragDelay,revert:s.behaviour.dragRevert,opacity:s.behaviour.dragOpacity,connectWith:$(s.selectors.columns),placeholder:s.selectors.placeHolder,start:function(e,ui){$(ui.helper).addClass('dragging');},stop:function(e,ui){$(ui.item).removeClass('dragging');$(ui.item).css({width:''});$(s.selectors.columns).sortable('enable');var widgetsPosition='';$(s.selectors.columns).each(function(i){var thisColumn=this;var widgetsValue='';var columnValue=thisColumn.id+'=';$(thisColumn).children(s.selectors.widget).each(function(j){var thisWidget=this;if(widgetsValue==''){widgetsValue+=thisWidget.id;}else{widgetsValue+=','+thisWidget.id;}});columnValue+=widgetsValue;if(widgetsPosition==''){widgetsPosition+=columnValue;}else{widgetsPosition+='|'+columnValue;}});if($.isFunction(s.callbacks.onChangePositions)){s.callbacks.onChangePositions(widgetsPosition);}else if(s.behaviour.useCookies){if(GetCookie(s.cookies.positionName)!=widgetsPosition){SetCookie(s.cookies.positionName,widgetsPosition,s);}}if($.isFunction(s.callbacks.onDragStop)){s.callbacks.onDragStop(e,ui);}return true;}});if(s.behaviour.useCookies&&(GetCookie(s.cookies.disableName)==1)){$.fn.DisableEasyWidgets(s);}var cleanCookies=(Math.ceil(Math.random()*3)==1)&&s.behaviour.useCookies&&(widgetsIds.length>0);if(cleanCookies){i=j=0;var cookies=new Array(s.cookies.closeName,s.cookies.collapseName);var cookiesLen=cookies.length;for(i=0;i<cookiesLen;i++){if(GetCookie(cookies[i])){var widgetId='';var cleanValue='';var storedValue=GetCookie(cookies[i]).split(',');var storedWidgets=storedValue.length;for(j=0;j<storedWidgets;j++){widgetId=$.trim(storedValue[j]);if($.inArray(widgetId,widgetsIds)!=-1){if($.trim(cleanValue)==''){cleanValue+=widgetId;}else{cleanValue+=','+widgetId;}}}SetCookie(cookies[i],cleanValue,s);}}}};$.fn.DisableEasyWidgets=function(settings){var canDisable=true;var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);if($.isFunction(s.callbacks.onDisableQuery)){canDisable=s.callbacks.onDisableQuery();}if(canDisable){$(s.selectors.columns).sortable('disable');$(s.selectors.widget+':visible').each(function(){var thisWidget=$(this);if(thisWidget.hasClass(s.options.movable)){thisWidget.find(s.selectors.header).css('cursor','default');}});if($.isFunction(s.callbacks.onDisable)){s.callbacks.onDisable();}SetCookie(s.cookies.disableName,1,s);return true;}else{return false;}};$.fn.EnableEasyWidgets=function(settings){var canEnable=true;var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);if($.isFunction(s.callbacks.onEnableQuery)){canEnable=s.callbacks.onEnableQuery();}if(canEnable){$(s.selectors.columns).sortable('enable');$(s.selectors.widget+':visible').each(function(){var thisWidget=$(this);if(thisWidget.hasClass(s.options.movable)){thisWidget.find(s.selectors.header).css('cursor','move');}});if($.isFunction(s.callbacks.onEnable)){s.callbacks.onEnable();}if(s.behaviour.useCookies){SetCookie(s.cookies.disableName,0,s);}return true;}else{return false;}};$.fn.HideEasyWidgets=function(settings){var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);$(s.selectors.widget+':visible').each(function(){var canHide=true;var thisWidget=$(this);var thisWidgetId=thisWidget.attr('id');if($.isFunction(s.callbacks.onHideQuery)){canHide=s.callbacks.onHideQuery(thisWidget);}if(canHide){ApplyEffect(thisWidget,s.effects.widgetHide,s.effects.effectDuration,false);if(s.behaviour.useCookies&&thisWidgetId){UpdateCookie(thisWidgetId,s.cookies.closeName,s);}if($.isFunction(s.callbacks.onHide)){s.callbacks.onHide(thisWidget);}}});return true;};$.fn.ShowEasyWidgets=function(settings){var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);$(s.selectors.widget+':hidden').each(function(){var canShow=true;var thisWidget=$(this);var thisWidgetId=thisWidget.attr('id');if($.isFunction(s.callbacks.onShowQuery)){canShow=s.callbacks.onShowQuery(thisWidget);}if(canShow){ApplyEffect(thisWidget,s.effects.widgetShow,s.effects.effectDuration,true);if(s.behaviour.useCookies&&thisWidgetId){CleanCookie(thisWidgetId,s.cookies.closeName,s);}if($.isFunction(s.callbacks.onShow)){s.callbacks.onShow(thisWidget);}}});return true;};$.fn.ShowEasyWidget=function(id,settings){var canShow=true;var widgetId='#'+id;var thisWidget=$(widgetId);if(thisWidget.css('display')=='none'){var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);if($.isFunction(s.callbacks.onShowQuery)){canShow=s.callbacks.onShowQuery(thisWidget);}if(canShow){ApplyEffect(thisWidget,s.effects.widgetShow,s.effects.effectDuration,true);if(s.behaviour.useCookies){CleanCookie(id,s.cookies.closeName,s);}if($.isFunction(s.callbacks.onShow)){s.callbacks.onShow(thisWidget);}return true;}else{return false;}}else{return false;}};$.fn.HideEasyWidget=function(id,settings){var canHide=true;var widgetId='#'+id;var thisWidget=$(widgetId);if(thisWidget.css('display')!='none'){var s=$.extend(true,$.fn.EasyWidgets.defaults,settings);if($.isFunction(s.callbacks.onHideQuery)){canHide=s.callbacks.onHideQuery(thisWidget);}if(canHide){ApplyEffect(thisWidget,s.effects.widgetHide,s.effects.effectDuration,false);if(s.behaviour.useCookies){UpdateCookie(id,s.cookies.closeName,s);}if($.isFunction(s.callbacks.onHide)){s.callbacks.onHide(thisWidget);}return true;}else{return false;}}else{return false;}};$.fn.EasyWidgets.defaults={behaviour:{dragDelay:100,dragRevert:100,dragOpacity:0.8,useCookies:false},effects:{effectDuration:500,widgetShow:'none',widgetHide:'none',widgetClose:'none',widgetExtend:'none',widgetCollapse:'none',widgetOpenEdit:'none',widgetCloseEdit:'none',widgetCancelEdit:'none'},cookies:{path:'',domain:'',expires:90,secure:false,closeName:'ew-close',disableName:'ew-disable',positionName:'ew-position',collapseName:'ew-collapse'},options:{movable:'movable',editable:'editable',collapse:'collapse',removable:'removable',collapsable:'collapsable',closeConfirm:'closeconfirm'},callbacks:{onEdit:null,onShow:null,onHide:null,onClose:null,onEnable:null,onExtend:null,onDisable:null,onDragStop:null,onCollapse:null,onEditQuery:null,onShowQuery:null,onHideQuery:null,onCloseQuery:null,onCancelEdit:null,onEnableQuery:null,onExtendQuery:null,onDisableQuery:null,onCollapseQuery:null,onCancelEditQuery:null,onChangePositions:null,onRefreshPositions:null},selectors:{container:'div',widget:'.easyWidget',header:'.easyWidget-header',widgetMenu:'.easyWidget-menu',columns:'.easyWidget-column',editbox:'.easyWidget-editbox',content:'.easyWidget-content',closeEdit:'.easyWidget-close-editbox',editLink:'.easyWidget-editlink',closeLink:'.easyWidget-closelink',placeHolder:'easyWidget-placeholder',collapseLink:'.easyWidget-collapselink'},i18n:{editText:'Edit',closeText:'Close',extendText:'Extend',collapseText:'Collapse',cancelEditText:'Cancel',editTitle:'Edit this widget',closeTitle:'Close this widget',confirmMsg:'Remove this widget?',cancelEditTitle:'Cancel edition',extendTitle:'Extend this widget',collapseTitle:'Collapse this widget'}};function GetCookie(name){var result=null;if(document.cookie&&$.trim(document.cookie)!=''){var cookies=document.cookie.split(';');var cookiesLen=cookies.length;if(cookiesLen>0){for(var i=0;i<cookiesLen;i++){var cookie=$.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){result=decodeURIComponent(cookie.substring(name.length+1));break;}}}}return result;}function SetCookie(name,value,settings){var s=settings;var expires='';var nType='number';if(s.cookies.expires&&(typeof s.cookies.expires==nType||s.cookies.expires.toUTCString)){var date=null;if(typeof s.cookies.expires==nType){date=new Date();date.setTime(date.getTime()+(s.cookies.expires*24*60*60*1000));}else{date=s.cookies.expires;}expires='; expires='+date.toUTCString();}var path=s.cookies.path?'; path='+s.cookies.path:'';var domain=s.cookies.domain?'; domain='+s.cookies.domain:'';var secure=s.cookies.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');return true;}function CleanCookie(widgetId,cookieName,settings){value=GetCookie(cookieName);if(value!=null){if(value.indexOf(widgetId)!=-1){value=value.replace(','+widgetId,'');value=value.replace(widgetId+',','');value=value.replace(widgetId,'');}SetCookie(cookieName,value,settings);}return true;}function UpdateCookie(widgetId,cookieName,settings){var value=GetCookie(cookieName);if(!value){value=widgetId;}else if(value.indexOf(widgetId)==-1){value=value+','+widgetId;}SetCookie(cookieName,value,settings);return true;}function MenuLink(text,title,aClass){var link='<a href="#" title="TITLE" class="CLASS">TEXT</a>';link=link.replace(/TEXT/g,text);link=link.replace(/TITLE/g,title);link=link.replace(/CLASS/g,aClass.replace(/\./,''));return link;}function ApplyEffect(jqObj,effect,duration,show){var n='none',f='fade',s='slide';if(!show){if(effect==n){jqObj.hide();}else if(effect==f){jqObj.fadeOut(duration);}else if(effect==s){jqObj.slideUp(duration);}}else{if(effect==n){jqObj.show();}else if(effect==f){jqObj.fadeIn(duration);}else if(effect==s){jqObj.slideDown(duration);}}return true;}})(jQuery);
